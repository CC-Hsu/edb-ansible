---
# Tasks file for manage_pgbouncer Role

# Check if the Operating System is supported
- name: Check support for Operating System
  fail:
    msg: "Operating System = {{ os }} not supported."
  when: os not in supported_os

- name: Include the pgbouncer_set_databases
  include_tasks:
    file: pgbouncer_set_databases.yml
    apply:
      delegate_to: "{{ server.value.public_ip }}"
  when: (server.value.pgbouncer is true and server.value.node_type in supported_node_type) or server.value.node_type == 'pgbouncer'
  with_dict:  "{{ servers }}"
  loop_control:
    loop_var: server

- name: Include the pgbouncer_set_userlist
  include_tasks:
    file: pgbouncer_set_userlist.yml
    apply:
      delegate_to: "{{ server.value.public_ip }}"
  when: (server.value.pgbouncer is true and server.value.node_type in supported_node_type) or server.value.node_type == 'pgbouncer'
  with_dict:  "{{ servers }}"
  loop_control:
    loop_var: server
