---
# tasks file for facts

# This is internal variables processing please do not modify
- name: set_facts for all the variables
  set_fact:
    ALL_NODE_IPS: "{{ ALL_NODE_IPS + [item.value.private_ip] }}"

- name: Gather PEM Server IP information
  set_fact:
    PEM_SERVER_PRIVATE_IP: "{{ PEM_SERVER_PRIVATE_IP + item.value.private_ip }}"
    PEM_SERVER_PUBLIC_IP: "{{ PEM_SERVER_PUBLIC_IP + item.value.public_ip }}"
  when: item.value.node_type == 'pemserver'

- name: Gather primary Server IP information
  set_fact:
    PRIMARY_PRIVATE_IP: "{{ PRIMARY_PRIVATE_IP + item.value.private_ip }}"
    PRIMARY_PUBLIC_IP: "{{ PRIMARY_PUBLIC_IP  + item.value.public_ip }}"
  when: item.value.node_type == 'primary'

- name: Gather primary hostname if defined
  set_fact:
    PRIMARY_HOST_NAME: "{{ PRIMARY_HOST_NAME + item.value.hostname }}"
  when:
    - item.value.hostname is defined
    - item.value.node_type == 'primary'

- name: Gather the host and information for /etc/hosts
  set_fact:
    ALL_NODE_HOSTNAMES: "{{ ALL_NODE_HOSTNAMES + [item.value.hostname] }}"
    ETC_HOSTS_LISTS: "{{ ETC_HOSTS_LISTS + [item.value.private_ip + ' ' + item.value.hostname] }}"
  when: item.value.hostname is defined

- name: Gather EFM nodes
  set_fact:
      EFM_NODES_PRIVATE_IP: "{{ EFM_NODES_PRIVATE_IP + [item.value.private_ip] }}"
      EFM_NODES_PUBLIC_IP: "{{ EFM_NODES_PUBLIC_IP + [item.value.public_ip] }}"
  when: item.value.node_type in ['primary', 'standby']

- name: Gather hostnames for EFM 
  set_fact:
      EFM_NODES_HOSTS_LIST: "{{ EFM_NODES_HOSTS_LIST + [item.value.hostname] }}"
  when: 
    - item.value.hostname is defined
    - item.value.node_type in ['primary', 'standby']

- name: Gather the only standby names
  set_fact:
      STANDBY_NAMES: "{{ STANDBY_NAMES + [item.key] }}"
  when: item.value.node_type == 'standby'
